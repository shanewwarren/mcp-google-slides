# Fresher Docker Compose Configuration
# For CLI-only workflow (without VS Code devcontainers)
#
# Usage:
#   docker compose -f .fresher/docker/docker-compose.yml run --rm fresher

services:
  fresher:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: fresher-${FRESHER_MODE:-loop}

    # Interactive mode
    stdin_open: true
    tty: true

    # Resource limits
    mem_limit: ${FRESHER_DOCKER_MEMORY:-4g}
    cpus: ${FRESHER_DOCKER_CPUS:-2}

    # Volume mounts
    volumes:
      - ${PWD}:/workspace
      - fresher-claude-config:/home/node/.claude

    # Environment
    environment:
      - FRESHER_MODE=${FRESHER_MODE:-planning}
      - FRESHER_MAX_ITERATIONS=${FRESHER_MAX_ITERATIONS:-0}
      - FRESHER_IN_DOCKER=true
      - DEVCONTAINER=true
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}

    # Working directory
    working_dir: /workspace

    # Run Fresher
    command: /workspace/.fresher/run.sh

volumes:
  fresher-claude-config:
